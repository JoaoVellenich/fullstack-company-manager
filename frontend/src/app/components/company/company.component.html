<div class="company-page">
  <div class="page-header">
    <h1>Empresas</h1>
    <a routerLink="/companies/new" class="btn btn-primary">+ Nova Empresa</a>
  </div>

  <div class="search-bar">
    <input
      type="text"
      placeholder="Buscar por nome..."
      [(ngModel)]="searchName"
      (keyup.enter)="onSearch()"
    />
    <input
      type="text"
      placeholder="Buscar por CNPJ..."
      [(ngModel)]="searchCnpj"
      (keyup.enter)="onSearch()"
    />
    <button class="btn btn-secondary" (click)="onSearch()">Buscar</button>
  </div>

  @if (loading) {
    <div class="state-message">Carregando...</div>
  }

  @if (error) {
    <div class="state-message error">{{ error }}</div>
  }

  @if (!loading && !error && companies.length === 0) {
    <div class="state-message">Nenhuma empresa encontrada.</div>
  }

  @if (!loading && companies.length > 0) {
    <table class="data-table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>CNPJ</th>
          <th>CEP</th>
          <th>Estado</th>
          <th>Funcionários</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        @for (company of companies; track company.id) {
          <tr>
            <td><a [routerLink]="['/companies', company.id]" class="company-link">{{ company.companyName }}</a></td>
            <td>{{ formatCnpj(company.cnpj) }}</td>
            <td>{{ company.cep }}</td>
            <td>{{ company.state }}</td>
            <td>{{ company.employees.length }}</td>
            <td>
              <button class="btn btn-danger btn-sm" (click)="deleteCompany(company.id)">Excluir</button>
            </td>
          </tr>
        }
      </tbody>
    </table>

    @if (totalPages > 1) {
      <div class="pagination">
        <button
          class="btn btn-page"
          [disabled]="page === 0"
          (click)="goToPage(page - 1)"
        >
          Anterior
        </button>
        @for (p of pages; track p) {
          <button
            class="btn btn-page"
            [class.active]="p === page"
            (click)="goToPage(p)"
          >
            {{ p + 1 }}
          </button>
        }
        <button
          class="btn btn-page"
          [disabled]="page === totalPages - 1"
          (click)="goToPage(page + 1)"
        >
          Próximo
        </button>
      </div>
    }
  }
</div>
